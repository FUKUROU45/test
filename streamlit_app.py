import streamlit as st
import random
import json

# ãƒšãƒ¼ã‚¸è¨­å®š
st.set_page_config(
    page_title="ä¸­å­¦æ¼¢å­—ç·´ç¿’ã‚¢ãƒ—ãƒª",
    page_icon="ğŸ“š",
    layout="wide"
)

# ä¸­å­¦æ ¡ã®æ¼¢å­—ãƒ‡ãƒ¼ã‚¿ï¼ˆå„å­¦å¹´ã®ä»£è¡¨çš„ãªæ¼¢å­—ï¼‰
KANJI_DATA = {
    "1å¹´ç”Ÿ": {
        "æ¼¢å­—": [
            {"å­—": "åœ§", "èª­ã¿": "ã‚¢ãƒ„", "æ„å‘³": "ãŠã•ãˆã¤ã‘ã‚‹", "ä¾‹æ–‡": "åœ§åŠ›ã‚’ã‹ã‘ã‚‹"},
            {"å­—": "ç§»", "èª­ã¿": "ã‚¤", "æ„å‘³": "ã†ã¤ã‚‹ã€ã†ã¤ã™", "ä¾‹æ–‡": "ç§»å‹•ã™ã‚‹"},
            {"å­—": "å› ", "èª­ã¿": "ã‚¤ãƒ³", "æ„å‘³": "ã‚‚ã¨ã€åŸå› ", "ä¾‹æ–‡": "å› æœé–¢ä¿‚"},
            {"å­—": "æ°¸", "èª­ã¿": "ã‚¨ã‚¤", "æ„å‘³": "ãªãŒã„", "ä¾‹æ–‡": "æ°¸é ã«ç¶šã"},
            {"å­—": "å–¶", "èª­ã¿": "ã‚¨ã‚¤", "æ„å‘³": "ã„ã¨ãªã‚€", "ä¾‹æ–‡": "å–¶æ¥­ã™ã‚‹"},
            {"å­—": "è¡›", "èª­ã¿": "ã‚¨ã‚¤", "æ„å‘³": "ã¾ã‚‚ã‚‹", "ä¾‹æ–‡": "è¡›ç”Ÿç®¡ç†"},
            {"å­—": "æ˜“", "èª­ã¿": "ã‚¨ã‚­", "æ„å‘³": "ã‚„ã•ã—ã„", "ä¾‹æ–‡": "æ˜“ã—ã„å•é¡Œ"},
            {"å­—": "ç›Š", "èª­ã¿": "ã‚¨ã‚­", "æ„å‘³": "ãŸã‚ã«ãªã‚‹", "ä¾‹æ–‡": "åˆ©ç›Šã‚’å¾—ã‚‹"},
            {"å­—": "æ¶²", "èª­ã¿": "ã‚¨ã‚­", "æ„å‘³": "ã¿ãšã‘", "ä¾‹æ–‡": "æ¶²ä½“çŠ¶æ…‹"},
            {"å­—": "æ¼”", "èª­ã¿": "ã‚¨ãƒ³", "æ„å‘³": "ã®ã¹ã‚‹", "ä¾‹æ–‡": "æ¼”èª¬ã™ã‚‹"},
            {"å­—": "å¿œ", "èª­ã¿": "ã‚ªã‚¦", "æ„å‘³": "ã“ãŸãˆã‚‹", "ä¾‹æ–‡": "å¿œç­”ã™ã‚‹"},
            {"å­—": "å¾€", "èª­ã¿": "ã‚ªã‚¦", "æ„å‘³": "ã„ã", "ä¾‹æ–‡": "å¾€å¾©ã™ã‚‹"},
            {"å­—": "æ¡œ", "èª­ã¿": "ã‚ªã‚¦", "æ„å‘³": "ã•ãã‚‰", "ä¾‹æ–‡": "æ¡œã®èŠ±"},
            {"å­—": "æ©", "èª­ã¿": "ã‚ªãƒ³", "æ„å‘³": "ã‚ãã¿", "ä¾‹æ–‡": "æ©å¸«ã¸ã®æ„Ÿè¬"},
            {"å­—": "å¯", "èª­ã¿": "ã‚«", "æ„å‘³": "ã‚ˆã„", "ä¾‹æ–‡": "å¯èƒ½æ€§"},
            {"å­—": "ä»®", "èª­ã¿": "ã‚«", "æ„å‘³": "ã‹ã‚Š", "ä¾‹æ–‡": "ä»®å®šã™ã‚‹"},
            {"å­—": "ä¾¡", "èª­ã¿": "ã‚«", "æ„å‘³": "ã­ã ã‚“", "ä¾‹æ–‡": "ä¾¡æ ¼è¡¨ç¤º"},
            {"å­—": "æ²³", "èª­ã¿": "ã‚«", "æ„å‘³": "ã‹ã‚", "ä¾‹æ–‡": "æ²³å·æ•·"},
            {"å­—": "é", "èª­ã¿": "ã‚«", "æ„å‘³": "ã™ãã‚‹", "ä¾‹æ–‡": "éå»ã®è©±"},
            {"å­—": "å¿«", "èª­ã¿": "ã‚«ã‚¤", "æ„å‘³": "ã“ã“ã‚ã‚ˆã„", "ä¾‹æ–‡": "å¿«é©ãªéƒ¨å±‹"}
        ]
    },
    "2å¹´ç”Ÿ": {
        "æ¼¢å­—": [
            {"å­—": "è¼", "èª­ã¿": "ã‚­", "æ„å‘³": "ã‹ãŒã‚„ã", "ä¾‹æ–‡": "è¼ãæ˜Ÿ"},
            {"å­—": "æ©Ÿ", "èª­ã¿": "ã‚­", "æ„å‘³": "ã¯ãŸã‚‰ã", "ä¾‹æ–‡": "æ©Ÿæ¢°å·¥å­¦"},
            {"å­—": "æŠ€", "èª­ã¿": "ã‚®", "æ„å‘³": "ã‚ã–", "ä¾‹æ–‡": "æŠ€è¡“é©æ–°"},
            {"å­—": "ç¾©", "èª­ã¿": "ã‚®", "æ„å‘³": "ãŸã ã—ã„", "ä¾‹æ–‡": "æ­£ç¾©æ„Ÿ"},
            {"å­—": "é€†", "èª­ã¿": "ã‚®ãƒ£ã‚¯", "æ„å‘³": "ã•ã‹ã•ã¾", "ä¾‹æ–‡": "é€†è»¢å‹åˆ©"},
            {"å­—": "ä¹…", "èª­ã¿": "ã‚­ãƒ¥ã‚¦", "æ„å‘³": "ã²ã•ã—ã„", "ä¾‹æ–‡": "ä¹…ã—ã¶ã‚Š"},
            {"å­—": "æ—§", "èª­ã¿": "ã‚­ãƒ¥ã‚¦", "æ„å‘³": "ãµã‚‹ã„", "ä¾‹æ–‡": "æ—§å‹ã«ä¼šã†"},
            {"å­—": "å±…", "èª­ã¿": "ã‚­ãƒ§", "æ„å‘³": "ã„ã‚‹", "ä¾‹æ–‡": "å±…ä½åœ°"},
            {"å­—": "è¨±", "èª­ã¿": "ã‚­ãƒ§", "æ„å‘³": "ã‚†ã‚‹ã™", "ä¾‹æ–‡": "è¨±å¯è¨¼"},
            {"å­—": "å¢ƒ", "èª­ã¿": "ã‚­ãƒ§ã‚¦", "æ„å‘³": "ã•ã‹ã„", "ä¾‹æ–‡": "å¢ƒç•Œç·š"},
            {"å­—": "å‡", "èª­ã¿": "ã‚­ãƒ³", "æ„å‘³": "ã²ã¨ã—ã„", "ä¾‹æ–‡": "å¹³å‡å€¤"},
            {"å­—": "ç¦", "èª­ã¿": "ã‚­ãƒ³", "æ„å‘³": "ã„ã¾ã—ã‚ã‚‹", "ä¾‹æ–‡": "ç¦æ­¢äº‹é …"},
            {"å­—": "å¥", "èª­ã¿": "ã‚¯", "æ„å‘³": "ã“ã¨ã°", "ä¾‹æ–‡": "æ–‡å¥ã‚’è¨€ã†"},
            {"å­—": "ç¾¤", "èª­ã¿": "ã‚°ãƒ³", "æ„å‘³": "ã‚€ã‚Œ", "ä¾‹æ–‡": "ç¾¤è¡†å¿ƒç†"},
            {"å­—": "çµŒ", "èª­ã¿": "ã‚±ã‚¤", "æ„å‘³": "ãŸã¤", "ä¾‹æ–‡": "çµŒé¨“è±Šå¯Œ"},
            {"å­—": "æ½”", "èª­ã¿": "ã‚±ãƒ„", "æ„å‘³": "ãã‚ˆã„", "ä¾‹æ–‡": "æ½”ç™½ã‚’è¨¼æ˜"},
            {"å­—": "ä»¶", "èª­ã¿": "ã‚±ãƒ³", "æ„å‘³": "ãã ã‚Š", "ä¾‹æ–‡": "äº‹ä»¶ã®çœŸç›¸"},
            {"å­—": "é™º", "èª­ã¿": "ã‚±ãƒ³", "æ„å‘³": "ã‘ã‚ã—ã„", "ä¾‹æ–‡": "é™ºã—ã„å±±é“"},
            {"å­—": "æ¤œ", "èª­ã¿": "ã‚±ãƒ³", "æ„å‘³": "ã—ã‚‰ã¹ã‚‹", "ä¾‹æ–‡": "æ¤œæŸ»çµæœ"},
            {"å­—": "é™", "èª­ã¿": "ã‚²ãƒ³", "æ„å‘³": "ã‹ãã‚‹", "ä¾‹æ–‡": "åˆ¶é™æ™‚é–“"}
        ]
    },
    "3å¹´ç”Ÿ": {
        "æ¼¢å­—": [
            {"å­—": "çµ¹", "èª­ã¿": "ã‚±ãƒ³", "æ„å‘³": "ãã¬", "ä¾‹æ–‡": "çµ¹ã®ç€ç‰©"},
            {"å­—": "æ¨©", "èª­ã¿": "ã‚±ãƒ³", "æ„å‘³": "ã¡ã‹ã‚‰", "ä¾‹æ–‡": "æ¨©åˆ©ä¸»å¼µ"},
            {"å­—": "æ†²", "èª­ã¿": "ã‚±ãƒ³", "æ„å‘³": "ã®ã‚Š", "ä¾‹æ–‡": "æ†²æ³•æ”¹æ­£"},
            {"å­—": "æº", "èª­ã¿": "ã‚²ãƒ³", "æ„å‘³": "ã¿ãªã‚‚ã¨", "ä¾‹æ–‡": "æºæ³‰å¾´å"},
            {"å­—": "å³", "èª­ã¿": "ã‚²ãƒ³", "æ„å‘³": "ãã³ã—ã„", "ä¾‹æ–‡": "å³æ ¼ãªè¦å‰‡"},
            {"å­—": "å·±", "èª­ã¿": "ã‚³", "æ„å‘³": "ãŠã®ã‚Œ", "ä¾‹æ–‡": "è‡ªåˆ†è‡ªèº«"},
            {"å­—": "å‘¼", "èª­ã¿": "ã‚³", "æ„å‘³": "ã‚ˆã¶", "ä¾‹æ–‡": "å‘¼å¸å›°é›£"},
            {"å­—": "èª¤", "èª­ã¿": "ã‚´", "æ„å‘³": "ã¾ã¡ãŒãˆã‚‹", "ä¾‹æ–‡": "èª¤è§£ã‚’æ‹›ã"},
            {"å­—": "å", "èª­ã¿": "ã‚³ã‚¦", "æ„å‘³": "ãã•ã", "ä¾‹æ–‡": "çš‡åé™›ä¸‹"},
            {"å­—": "å­", "èª­ã¿": "ã‚³ã‚¦", "æ„å‘³": "ã—ãŸãŒã†", "ä¾‹æ–‡": "å­è¡Œæ¯å­"},
            {"å­—": "çš‡", "èª­ã¿": "ã‚³ã‚¦", "æ„å‘³": "ãã¿", "ä¾‹æ–‡": "çš‡å®¤åˆ¶åº¦"},
            {"å­—": "ç´…", "èª­ã¿": "ã‚³ã‚¦", "æ„å‘³": "ã¹ã«", "ä¾‹æ–‡": "ç´…è‘‰ã®å­£ç¯€"},
            {"å­—": "é™", "èª­ã¿": "ã‚³ã‚¦", "æ„å‘³": "ãŠã‚Šã‚‹", "ä¾‹æ–‡": "é™æ°´ç¢ºç‡"},
            {"å­—": "é‹¼", "èª­ã¿": "ã‚³ã‚¦", "æ„å‘³": "ã¯ãŒã­", "ä¾‹æ–‡": "é‹¼é‰„è£½å“"},
            {"å­—": "åˆ»", "èª­ã¿": "ã‚³ã‚¯", "æ„å‘³": "ãã–ã‚€", "ä¾‹æ–‡": "åˆ»å°ã‚’æŠ¼ã™"},
            {"å­—": "ç©€", "èª­ã¿": "ã‚³ã‚¯", "æ„å‘³": "ãŸãªã¤ã‚‚ã®", "ä¾‹æ–‡": "ç©€ç‰©ç”Ÿç”£"},
            {"å­—": "éª¨", "èª­ã¿": "ã‚³ãƒ„", "æ„å‘³": "ã»ã­", "ä¾‹æ–‡": "éª¨çµ„ã¿æ§‹é€ "},
            {"å­—": "å›°", "èª­ã¿": "ã‚³ãƒ³", "æ„å‘³": "ã“ã¾ã‚‹", "ä¾‹æ–‡": "å›°é›£ãªçŠ¶æ³"},
            {"å­—": "ç ‚", "èª­ã¿": "ã‚µ", "æ„å‘³": "ã™ãª", "ä¾‹æ–‡": "ç ‚æ¼ åœ°å¸¯"},
            {"å­—": "åº§", "èª­ã¿": "ã‚¶", "æ„å‘³": "ã™ã‚ã‚‹", "ä¾‹æ–‡": "åº§å¸­æŒ‡å®š"}
        ]
    }
}

# ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®åˆæœŸåŒ–
if 'current_problem' not in st.session_state:
    st.session_state.current_problem = None
if 'problem_type' not in st.session_state:
    st.session_state.problem_type = "èª­ã¿æ–¹"
if 'grade' not in st.session_state:
    st.session_state.grade = "1å¹´ç”Ÿ"
if 'score' not in st.session_state:
    st.session_state.score = 0
if 'total_problems' not in st.session_state:
    st.session_state.total_problems = 0
if 'show_answer' not in st.session_state:
    st.session_state.show_answer = False
if 'user_answer' not in st.session_state:
    st.session_state.user_answer = ""

def generate_problem(grade, problem_type):
    """å•é¡Œã‚’ç”Ÿæˆã™ã‚‹"""
    kanji_list = KANJI_DATA[grade]["æ¼¢å­—"]
    kanji = random.choice(kanji_list)
    
    if problem_type == "èª­ã¿æ–¹":
        return {
            "type": "èª­ã¿æ–¹",
            "question": f"ã€Œ{kanji['å­—']}ã€ã®èª­ã¿æ–¹ã¯ï¼Ÿ",
            "kanji": kanji["å­—"],
            "correct_answer": kanji["èª­ã¿"],
            "example": kanji["ä¾‹æ–‡"],
            "meaning": kanji["æ„å‘³"]
        }
    elif problem_type == "æ›¸ãæ–¹":
        return {
            "type": "æ›¸ãæ–¹",
            "question": f"ã€Œ{kanji['èª­ã¿']}ã€ã®æ¼¢å­—ã¯ï¼Ÿ",
            "reading": kanji["èª­ã¿"],
            "correct_answer": kanji["å­—"],
            "example": kanji["ä¾‹æ–‡"],
            "meaning": kanji["æ„å‘³"]
        }
    elif problem_type == "æ„å‘³":
        return {
            "type": "æ„å‘³",
            "question": f"ã€Œ{kanji['å­—']}ã€ã®æ„å‘³ã¯ï¼Ÿ",
            "kanji": kanji["å­—"],
            "correct_answer": kanji["æ„å‘³"],
            "example": kanji["ä¾‹æ–‡"],
            "reading": kanji["èª­ã¿"]
        }
    else:  # ä¾‹æ–‡
        # ä¾‹æ–‡ã®æ¼¢å­—ã‚’ç©ºæ¬„ã«ã™ã‚‹
        example_with_blank = kanji["ä¾‹æ–‡"].replace(kanji["å­—"], "â–¡")
        return {
            "type": "ä¾‹æ–‡",
            "question": f"ã€Œâ–¡ã€ã«å…¥ã‚‹æ¼¢å­—ã¯ï¼Ÿ\nä¾‹æ–‡ï¼š{example_with_blank}",
            "correct_answer": kanji["å­—"],
            "example": kanji["ä¾‹æ–‡"],
            "reading": kanji["èª­ã¿"],
            "meaning": kanji["æ„å‘³"]
        }

def generate_choices(correct_answer, grade, problem_type):
    """é¸æŠè‚¢ã‚’ç”Ÿæˆã™ã‚‹"""
    kanji_list = KANJI_DATA[grade]["æ¼¢å­—"]
    
    if problem_type == "èª­ã¿æ–¹":
        all_answers = [k["èª­ã¿"] for k in kanji_list]
    elif problem_type == "æ›¸ãæ–¹" or problem_type == "ä¾‹æ–‡":
        all_answers = [k["å­—"] for k in kanji_list]
    else:  # æ„å‘³
        all_answers = [k["æ„å‘³"] for k in kanji_list]
    
    # æ­£è§£ä»¥å¤–ã®é¸æŠè‚¢ã‚’3ã¤é¸ã¶
    wrong_answers = [ans for ans in all_answers if ans != correct_answer]
    choices = random.sample(wrong_answers, min(3, len(wrong_answers)))
    choices.append(correct_answer)
    random.shuffle(choices)
    
    return choices

# ã‚¢ãƒ—ãƒªã‚¿ã‚¤ãƒˆãƒ«
st.title("ğŸ“š ä¸­å­¦æ¼¢å­—ç·´ç¿’ã‚¢ãƒ—ãƒª")
st.markdown("**ä¸­å­¦æ ¡1å¹´ç”Ÿã‹ã‚‰3å¹´ç”Ÿã®æ¼¢å­—ã‚’æ¥½ã—ãå­¦ç¿’ã—ã‚ˆã†ï¼**")

# ã‚µã‚¤ãƒ‰ãƒãƒ¼è¨­å®š
st.sidebar.header("ğŸ“ å­¦ç¿’è¨­å®š")
grade = st.sidebar.selectbox("å­¦å¹´ã‚’é¸æŠ", ["1å¹´ç”Ÿ", "2å¹´ç”Ÿ", "3å¹´ç”Ÿ"])
problem_type = st.sidebar.selectbox(
    "å•é¡Œã®ç¨®é¡", 
    ["èª­ã¿æ–¹", "æ›¸ãæ–¹", "æ„å‘³", "ä¾‹æ–‡"]
)

st.sidebar.header("ğŸ“Š å­¦ç¿’æˆç¸¾")
if st.session_state.total_problems > 0:
    accuracy = (st.session_state.score / st.session_state.total_problems) * 100
    st.sidebar.metric("æ­£ç­”ç‡", f"{accuracy:.1f}%")
    st.sidebar.metric("æ­£è§£æ•°", f"{st.session_state.score}/{st.session_state.total_problems}")

st.sidebar.header("ğŸ¯ å­¦ç¿’ã®ãƒã‚¤ãƒ³ãƒˆ")
st.sidebar.markdown("""
- **èª­ã¿æ–¹**: æ¼¢å­—ã‚’è¦‹ã¦èª­ã¿æ–¹ã‚’ç­”ãˆã‚‹
- **æ›¸ãæ–¹**: èª­ã¿æ–¹ã‚’è¦‹ã¦æ¼¢å­—ã‚’æ›¸ã
- **æ„å‘³**: æ¼¢å­—ã®æ„å‘³ã‚’ç†è§£ã™ã‚‹
- **ä¾‹æ–‡**: æ–‡è„ˆã‹ã‚‰æ¼¢å­—ã‚’æ¨æ¸¬ã™ã‚‹
""")

# ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
col1, col2 = st.columns([3, 2])

with col1:
    st.header("ğŸ¯ æ¼¢å­—å•é¡Œ")
    
    # æ–°ã—ã„å•é¡Œã‚’ç”Ÿæˆ
    if st.button("ğŸ² æ–°ã—ã„å•é¡Œ", type="primary"):
        st.session_state.current_problem = generate_problem(grade, problem_type)
        st.session_state.show_answer = False
        st.session_state.user_answer = ""
        st.session_state.grade = grade
        st.session_state.problem_type = problem_type
        st.rerun()
    
    # å•é¡Œã‚’è¡¨ç¤º
    if st.session_state.current_problem:
        problem = st.session_state.current_problem
        
        st.subheader(f"ã€{st.session_state.grade} - {problem['type']}å•é¡Œã€‘")
        st.markdown(f"**å•é¡Œ**: {problem['question']}")
        
        # å•é¡Œã®ç¨®é¡ã«å¿œã˜ãŸè§£ç­”æ–¹æ³•
        if problem['type'] in ["èª­ã¿æ–¹", "æ„å‘³"]:
            # é¸æŠè‚¢å•é¡Œ
            choices = generate_choices(problem['correct_answer'], st.session_state.grade, problem['type'])
            selected_answer = st.radio("ç­”ãˆã‚’é¸ã‚“ã§ãã ã•ã„ï¼š", choices, key="answer_choice")
            
            if st.button("âœ… ç­”ãˆã‚’ç¢ºèª"):
                st.session_state.total_problems += 1
                if selected_answer == problem['correct_answer']:
                    st.success("ğŸ‰ æ­£è§£ã§ã™ï¼ç´ æ™´ã‚‰ã—ã„ï¼")
                    st.session_state.score += 1
                    st.balloons()
                else:
                    st.error(f"âŒ æ®‹å¿µï¼æ­£è§£ã¯ã€Œ{problem['correct_answer']}ã€ã§ã™ã€‚")
                
                # è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º
                st.session_state.show_answer = True
                st.rerun()
        
        else:
            # è¨˜è¿°å•é¡Œï¼ˆæ›¸ãæ–¹ã€ä¾‹æ–‡ï¼‰
            user_input = st.text_input("ç­”ãˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š", key="text_input")
            
            if st.button("âœ… ç­”ãˆã‚’ç¢ºèª"):
                st.session_state.total_problems += 1
                if user_input.strip() == problem['correct_answer']:
                    st.success("ğŸ‰ æ­£è§£ã§ã™ï¼ç´ æ™´ã‚‰ã—ã„ï¼")
                    st.session_state.score += 1
                    st.balloons()
                else:
                    st.error(f"âŒ æ®‹å¿µï¼æ­£è§£ã¯ã€Œ{problem['correct_answer']}ã€ã§ã™ã€‚")
                
                # è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º
                st.session_state.show_answer = True
                st.rerun()
        
        # è©³ç´°æƒ…å ±è¡¨ç¤º
        if st.session_state.show_answer:
            st.subheader("ğŸ“– è©³ç´°æƒ…å ±")
            
            with st.expander("æ¼¢å­—ã®è©³ç´°", expanded=True):
                if problem['type'] == "èª­ã¿æ–¹":
                    st.write(f"**æ¼¢å­—**: {problem['kanji']}")
                    st.write(f"**èª­ã¿æ–¹**: {problem['correct_answer']}")
                    st.write(f"**æ„å‘³**: {problem['meaning']}")
                    st.write(f"**ä¾‹æ–‡**: {problem['example']}")
                elif problem['type'] == "æ›¸ãæ–¹":
                    st.write(f"**èª­ã¿æ–¹**: {problem['reading']}")
                    st.write(f"**æ¼¢å­—**: {problem['correct_answer']}")
                    st.write(f"**æ„å‘³**: {problem['meaning']}")
                    st.write(f"**ä¾‹æ–‡**: {problem['example']}")
                elif problem['type'] == "æ„å‘³":
                    st.write(f"**æ¼¢å­—**: {problem['kanji']}")
                    st.write(f"**èª­ã¿æ–¹**: {problem['reading']}")
                    st.write(f"**æ„å‘³**: {problem['correct_answer']}")
                    st.write(f"**ä¾‹æ–‡**: {problem['example']}")
                else:  # ä¾‹æ–‡
                    st.write(f"**æ¼¢å­—**: {problem['correct_answer']}")
                    st.write(f"**èª­ã¿æ–¹**: {problem['reading']}")
                    st.write(f"**æ„å‘³**: {problem['meaning']}")
                    st.write(f"**ä¾‹æ–‡**: {problem['example']}")

with col2:
    st.header("ğŸ“š å­¦ç¿’æ”¯æ´")
    
    # ç¾åœ¨ã®è¨­å®šã‚’è¡¨ç¤º
    st.subheader("ç¾åœ¨ã®è¨­å®š")
    st.write(f"**å­¦å¹´**: {grade}")
    st.write(f"**å•é¡Œç¨®é¡**: {problem_type}")
    
    # å­¦ç¿’ã®ã‚³ãƒ„
    st.subheader("ğŸ’¡ å­¦ç¿’ã®ã‚³ãƒ„")
    if problem_type == "èª­ã¿æ–¹":
        st.markdown("""
        - æ¼¢å­—ã®éƒ¨é¦–ã‹ã‚‰æ¨æ¸¬ã—ã¦ã¿ã‚ˆã†
        - ä¼¼ãŸæ¼¢å­—ã¨æ¯”è¼ƒã—ã¦ã¿ã‚ˆã†
        - ä¾‹æ–‡ã‚’å£°ã«å‡ºã—ã¦èª­ã‚“ã§ã¿ã‚ˆã†
        """)
    elif problem_type == "æ›¸ãæ–¹":
        st.markdown("""
        - æ¼¢å­—ã®ç”»æ•°ã‚’æ„è­˜ã—ã‚ˆã†
        - éƒ¨é¦–ã®çµ„ã¿åˆã‚ã›ã‚’è¦šãˆã‚ˆã†
        - ç¹°ã‚Šè¿”ã—æ›¸ã„ã¦è¦šãˆã‚ˆã†
        """)
    elif problem_type == "æ„å‘³":
        st.markdown("""
        - æ¼¢å­—ã®æˆã‚Šç«‹ã¡ã‚’ç†è§£ã—ã‚ˆã†
        - ç†Ÿèªã‹ã‚‰æ„å‘³ã‚’æ¨æ¸¬ã—ã‚ˆã†
        - ä¾‹æ–‡ã®æ–‡è„ˆã‚’è€ƒãˆã‚ˆã†
        """)
    else:  # ä¾‹æ–‡
        st.markdown("""
        - æ–‡è„ˆã‹ã‚‰æ„å‘³ã‚’æ¨æ¸¬ã—ã‚ˆã†
        - å‰å¾Œã®æ–‡ç« ã‚’ã‚ˆãèª­ã‚‚ã†
        - çŸ¥ã£ã¦ã„ã‚‹æ¼¢å­—ã‹ã‚‰é¡æ¨ã—ã‚ˆã†
        """)
    
    # å­¦å¹´åˆ¥ã®ç‰¹å¾´
    st.subheader("ğŸ“– å­¦å¹´åˆ¥ã®ç‰¹å¾´")
    if grade == "1å¹´ç”Ÿ":
        st.write("åŸºæœ¬çš„ãªæ¼¢å­—ãŒä¸­å¿ƒã€‚æ—¥å¸¸ã§ã‚ˆãä½¿ã†æ¼¢å­—ã‚’è¦šãˆã‚ˆã†ã€‚")
    elif grade == "2å¹´ç”Ÿ":
        st.write("è¤‡é›‘ãªæ¼¢å­—ãŒå¢—åŠ ã€‚éƒ¨é¦–ã®çŸ¥è­˜ã‚’æ´»ç”¨ã—ã‚ˆã†ã€‚")
    else:  # 3å¹´ç”Ÿ
        st.write("é«˜åº¦ãªæ¼¢å­—ãŒç™»å ´ã€‚ç†Ÿèªã§ã®ä½¿ã„æ–¹ã‚‚è¦šãˆã‚ˆã†ã€‚")

# æˆç¸¾ãƒªã‚»ãƒƒãƒˆ
if st.button("ğŸ”„ æˆç¸¾ã‚’ãƒªã‚»ãƒƒãƒˆ"):
    st.session_state.score = 0
    st.session_state.total_problems = 0
    st.success("æˆç¸¾ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸï¼")
    st.rerun()

# ãƒ•ãƒƒã‚¿ãƒ¼
st.markdown("---")
st.markdown("**ğŸ“ ç¶™ç¶šçš„ãªå­¦ç¿’ã§æ¼¢å­—åŠ›ã‚’å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†ï¼**")
st.markdown("*æ¯æ—¥å°‘ã—ãšã¤ã§ã‚‚ç¶šã‘ã‚‹ã“ã¨ãŒå¤§åˆ‡ã§ã™ã€‚*")